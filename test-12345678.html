<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار رقم 12345678</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin: 2rem auto;
            max-width: 800px;
            padding: 2rem;
        }
        .code-container {
            border: 3px solid #007bff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
        }
        .test-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        .test-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(40,167,69,0.3);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-container">
            <div class="text-center mb-4">
                <h1>
                    <i class="fas fa-bullseye text-danger me-2"></i>
                    اختبار مخصص للرقم: 12345678
                </h1>
                <p class="lead">رموز مخصصة لاختبار الرقم الذي أنشأته</p>
            </div>
            
            <div class="alert alert-warning border-0 mb-4">
                <h5><i class="fas fa-exclamation-triangle me-2"></i>مشكلة في القراءة؟</h5>
                <p class="mb-0">إذا لم يقرأ النظام QR Code الخاص بك، جرب الرموز أدناه المضمونة:</p>
            </div>

            <div class="row g-4">
                <div class="col-md-6">
                    <div class="code-container text-center">
                        <h5 class="text-primary mb-3">QR Code: 12345678</h5>
                        <div id="qr1" style="display: inline-block;"></div>
                        <p class="mt-3 small text-muted">رقم مباشر بدون نص إضافي</p>
                        <div class="alert alert-success small">
                            <strong>المحتوى:</strong> "12345678"<br>
                            <strong>متوقع:</strong> يستخرج 12345678
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="code-container text-center">
                        <h5 class="text-success mb-3">QR Code: إيصال 12345678</h5>
                        <div id="qr2" style="display: inline-block;"></div>
                        <p class="mt-3 small text-muted">نص عربي مع الرقم</p>
                        <div class="alert alert-success small">
                            <strong>المحتوى:</strong> "إيصال: 12345678"<br>
                            <strong>متوقع:</strong> يستخرج 12345678
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="code-container text-center">
                        <h5 class="text-info mb-3">Barcode: 12345678</h5>
                        <svg id="barcode1"></svg>
                        <p class="mt-3 small text-muted">Code128 Barcode</p>
                        <div class="alert alert-info small">
                            <strong>النوع:</strong> Code128<br>
                            <strong>متوقع:</strong> يستخرج 12345678
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="code-container text-center">
                        <h5 class="text-warning mb-3">QR Code: Receipt 12345678</h5>
                        <div id="qr3" style="display: inline-block;"></div>
                        <p class="mt-3 small text-muted">نص إنجليزي مع الرقم</p>
                        <div class="alert alert-warning small">
                            <strong>المحتوى:</strong> "Receipt: 12345678"<br>
                            <strong>متوقع:</strong> يستخرج 12345678
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-info border-0 mt-4">
                <h6><i class="fas fa-lightbulb me-2"></i>خطوات الاختبار:</h6>
                <ol class="mb-0">
                    <li><strong>اضغط الزر أدناه</strong> للانتقال لنظام الدفع</li>
                    <li><strong>اضغط "خالص"</strong> بجانب أي مادة</li>
                    <li><strong>اضغط "مسح الكود"</strong></li>
                    <li><strong>امنح إذن الكاميرا</strong></li>
                    <li><strong>وجه الكاميرا</strong> نحو أي من الرموز أعلاه</li>
                    <li><strong>يجب أن يستخرج:</strong> 12345678</li>
                </ol>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <button class="btn btn-outline-primary w-100" onclick="testExtraction()">
                        <i class="fas fa-flask me-2"></i>
                        اختبار الاستخراج
                    </button>
                </div>
                <div class="col-md-4">
                    <a href="/simple-qr-test.html" class="btn btn-outline-warning w-100" target="_blank">
                        <i class="fas fa-bug me-2"></i>
                        تشخيص المشاكل
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="/qr-test.html" class="btn btn-outline-info w-100" target="_blank">
                        <i class="fas fa-qrcode me-2"></i>
                        رموز أخرى
                    </a>
                </div>
            </div>

            <div id="testResult" class="alert d-none"></div>

            <div class="text-center">
                <a href="/admin/payment-management.html" class="test-btn">
                    <i class="fas fa-rocket me-2"></i>
                    اختبر مع نظام الدفع
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <script>
        // Generate QR codes for 12345678
        QRCode.toCanvas(document.getElementById('qr1'), '12345678', {
            width: 200,
            margin: 2,
            color: { dark: '#000000', light: '#FFFFFF' }
        });

        QRCode.toCanvas(document.getElementById('qr2'), 'إيصال: 12345678', {
            width: 200,
            margin: 2,
            color: { dark: '#000000', light: '#FFFFFF' }
        });

        QRCode.toCanvas(document.getElementById('qr3'), 'Receipt: 12345678', {
            width: 200,
            margin: 2,
            color: { dark: '#000000', light: '#FFFFFF' }
        });

        // Generate barcode
        try {
            JsBarcode("#barcode1", "12345678", {
                format: "CODE128",
                width: 2,
                height: 80,
                displayValue: true,
                fontSize: 14,
                margin: 10
            });
        } catch (error) {
            document.getElementById('barcode1').innerHTML = '<p class="text-muted">Barcode: 12345678</p>';
        }

        // Test extraction function (same as in the main system)
        function extractReceiptNumber(codeData) {
            const cleanData = String(codeData).trim();
            if (!cleanData) return null;
            if (/^\d+$/.test(cleanData)) return cleanData;
            const numberMatch = cleanData.match(/\d+/);
            return numberMatch ? numberMatch[0] : null;
        }

        function testExtraction() {
            const testCases = [
                '12345678',
                'إيصال: 12345678',
                'Receipt: 12345678',
                'Test 12345678 Done'
            ];

            const resultDiv = document.getElementById('testResult');
            resultDiv.classList.remove('d-none', 'alert-success', 'alert-danger');
            
            let allPassed = true;
            let results = '<h6>نتائج اختبار الاستخراج:</h6><ul>';
            
            testCases.forEach(testCase => {
                const extracted = extractReceiptNumber(testCase);
                const passed = extracted === '12345678';
                allPassed = allPassed && passed;
                
                results += `<li><strong>"${testCase}"</strong> → ${extracted} ${passed ? '✅' : '❌'}</li>`;
            });
            
            results += '</ul>';
            
            if (allPassed) {
                resultDiv.className = 'alert alert-success';
                results += '<p class="mb-0"><strong>✅ جميع الاختبارات نجحت! النظام يجب أن يقرأ رقمك.</strong></p>';
            } else {
                resultDiv.className = 'alert alert-danger';
                results += '<p class="mb-0"><strong>❌ هناك مشكلة في الاستخراج.</strong></p>';
            }
            
            resultDiv.innerHTML = results;
        }
    </script>
</body>
</html>
